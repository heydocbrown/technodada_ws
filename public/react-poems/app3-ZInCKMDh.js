import"./App-DqG_nQvU.js";import{r as s,j as e,c as B}from"./react-vendor-BxNt2Mgw.js";import{T as W}from"./ThumbnailSelector-DIRGQRXd.js";function w({prompt:a,imageUrl:r,startOverlay:y,revealMode:i="topToBottom"}){const[l,g]=s.useState(!1),[I,E]=s.useState(0),[d,j]=s.useState(1),[O,S]=s.useState(100),[P,L]=s.useState(0),[T,k]=s.useState(!1),[h,R]=s.useState(""),A=s.useRef(null);s.useRef(null);const u=s.useRef(null);s.useEffect(()=>{a&&r&&(g(!1),E(0),S(100),L(0),k(!1),R(""),u.current&&clearInterval(u.current))},[a,r]),s.useEffect(()=>{if(i==="randomPixels"&&l&&d){const n=N(400,Math.floor(400/d),P);R(n)}},[i,l,d]),s.useEffect(()=>{if(y&&l&&I>0&&!T){k(!0);const n=document.getElementById("gnosisLevel");return n&&(n.textContent="0%"),setTimeout(()=>{if(i==="topToBottom"){let t=100;u.current=setInterval(()=>{if(t-=1,t<=0){t=0,clearInterval(u.current);const m=document.getElementById("gnosisLevel");m&&(m.textContent="100%")}S(t);const x=document.getElementById("gnosisLevel");if(x){const m=Math.round(100-t);x.textContent=m+"%"}},70)}else if(i==="randomPixels"){let t=0;u.current=setInterval(()=>{if(t+=1,t>=100){t=100,clearInterval(u.current);const c=document.getElementById("gnosisLevel");c&&(c.textContent="100%")}L(t);const x=N(400,Math.floor(400/d),t);R(x);const m=document.getElementById("gnosisLevel");m&&(m.textContent=t+"%")},70)}},3e3),()=>{u.current&&clearInterval(u.current)}}},[y,l,I,T]);const N=(n,f,b)=>{const p=document.createElement("canvas");p.width=n,p.height=f;const t=p.getContext("2d");t.fillStyle="black",t.fillRect(0,0,n,f);const x=n*f,m=Math.floor(x*(b/100)),c=[];for(let o=0;o<x;o++)c.push(o);for(let o=c.length-1;o>0;o--){const v=Math.floor(Math.random()*(o+1));[c[o],c[v]]=[c[v],c[o]]}t.fillStyle="white";for(let o=0;o<m;o++){const v=c[o],M=v%n,C=Math.floor(v/n);t.fillRect(M,C,1,1)}return p.toDataURL()},_=n=>{if(g(!0),E(n.target.naturalHeight),j(n.target.naturalWidth/n.target.naturalHeight),i==="randomPixels"){const f=N(400,Math.floor(400/(n.target.naturalWidth/n.target.naturalHeight)),0);R(f)}};return!a&&!r?null:e.jsx("div",{className:"overlay-section",children:e.jsxs("div",{className:"terminal-window",children:[e.jsx("div",{className:"terminal-header",children:"> INITIATING REALITY_FUSION..."}),e.jsx("div",{className:"overlay-viewer",children:e.jsxs("div",{className:"overlay-container",style:{minHeight:l?`${600/d}px`:"500px",maxHeight:"700px"},children:[e.jsxs("div",{className:"overlay-text",children:["> ",e.jsx("span",{dangerouslySetInnerHTML:{__html:(a==null?void 0:a.replace(/\n/g,"<br/>"))||""}})]}),r&&l&&i==="topToBottom"&&e.jsx("img",{ref:A,src:r,alt:"REALITY_OVERLAY",className:"overlay-image",style:{display:"block",clipPath:`inset(0 0 ${O}% 0)`}}),r&&l&&i==="randomPixels"&&e.jsx("img",{ref:A,src:r,alt:"REALITY_OVERLAY",className:"overlay-image",style:{display:h?"block":"none",maskImage:h?`url(${h})`:"none",maskSize:"100% 100%",maskRepeat:"no-repeat",maskMode:"luminance",WebkitMaskImage:h?`url(${h})`:"none",WebkitMaskSize:"100% 100%",WebkitMaskRepeat:"no-repeat",WebkitMaskMode:"luminance"}}),r&&!l&&e.jsx("img",{src:r,alt:"PRELOAD",onLoad:_,style:{display:"none"}}),r&&!l&&e.jsxs("div",{className:"overlay-text",style:{display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",backgroundColor:"var(--gray-1)",zIndex:10},children:["> LOADING VISUAL_OVERLAY",e.jsx("br",{}),"> PREPARING FUSION_SEQUENCE"]})]})})]})})}function D(){const[a,r]=s.useState(null),[y,i]=s.useState(!0),[l,g]=s.useState("topToBottom"),I=E=>{r(E),i(!1);const d=document.getElementById("gnosisLevel");d&&(d.textContent="0%"),setTimeout(()=>{const j=window.pageYOffset||document.documentElement.scrollTop;i(!0),setTimeout(()=>{window.scrollTo({top:j,behavior:"instant"})},0)},11e3)};return e.jsxs("div",{className:"art-viewer-container",children:[e.jsxs("header",{className:"art-viewer-header",children:[e.jsx("h1",{className:"glitch",children:"TECHNODADA_FUSION"}),e.jsx("p",{className:"error-message",children:"WARNING: Reality layers may merge unexpectedly"}),e.jsxs("div",{className:"reveal-settings",style:{display:"flex",justifyContent:"center",gap:"15px",marginTop:"20px",fontFamily:"'VT323', monospace"},children:[e.jsx("span",{style:{color:"var(--terminal-green)",fontSize:"1.2rem"},children:"REVEAL_MODE:"}),e.jsx("button",{className:`project-button ${l==="topToBottom"?"active":""}`,onClick:()=>g("topToBottom"),style:{minWidth:"150px",padding:"8px 15px",fontSize:"0.9rem"},children:"TOPâ†’BOTTOM"}),e.jsx("button",{className:`project-button ${l==="randomPixels"?"active":""}`,onClick:()=>g("randomPixels"),style:{minWidth:"150px",padding:"8px 15px",fontSize:"0.9rem"},children:"RANDOM_PIXELS"})]})]}),a&&e.jsx("div",{className:"content-display",children:e.jsx(w,{prompt:(a==null?void 0:a.cleaned_prompt)||null,imageUrl:a?`https://f005.backblazeb2.com/file/td-website/${a.backblaze_path}`:null,startOverlay:a!==null,revealMode:l})}),e.jsx(W,{onArtSelect:I,isVisible:y}),e.jsxs("nav",{className:"error-nav",style:{textAlign:"center",marginTop:"40px"},children:[e.jsx("a",{href:"/",className:"error-link",children:"[RETURN_TO_404]"}),e.jsx("a",{href:"/pages/poems.html",className:"error-link",children:"[TEXT_VIEWER]"}),e.jsx("a",{href:"/pages/poem2.html",className:"error-link",children:"[GALLERY_VIEWER]"}),e.jsx("a",{href:"/pages/gallery.html",className:"error-link",children:"[BROWSE_GALLERY]"}),e.jsx("a",{href:"/pages/tools.html",className:"error-link",children:"[ACCESS_TOOLS]"})]})]})}B.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(D,{})}));
