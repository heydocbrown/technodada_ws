import"./App-DqG_nQvU.js";import{r as l,j as e,R as L,a as j}from"./react-vendor-BxNt2Mgw.js";import{c as P}from"./dadacat-pipeline-BJkuGlkY.js";import{P as b,I as V}from"./ImageViewer-c6U9iUCR.js";const w="https://f005.backblazeb2.com/file/td-website/index.json";function C({onArtSelect:a}){const[t,n]=l.useState([]),[E,d]=l.useState([]),[N,I]=l.useState([]),[_,h]=l.useState({}),[f,T]=l.useState(!0),[g,A]=l.useState(null);l.useEffect(()=>{x()},[]),l.useEffect(()=>{if(t.length>0){console.log("Filtering for dadacat with human_prompt"),console.log("Total artData items:",t.length);const o=t.filter(r=>r.artproject==="dadacat"&&r.on_website==="yes"&&r.human_prompt&&r.human_prompt.trim()!=="");console.log("Filtered items with human_prompt:",o.length);const s={};o.forEach(r=>{const p=r.human_prompt.trim();s[p]||(s[p]=[]),s[p].push(r)});const c=Object.keys(s).sort();console.log("Unique human_prompts:",c.length),console.log("Prompt mapping:",s),d(o),I(c),h(s)}else d([]),I([]),h({})},[t]);const x=async()=>{try{T(!0);const o=await fetch(w);if(!o.ok)throw new Error("Failed to fetch art data");const c=(await o.json()).images||[];n(c),T(!1)}catch(o){console.error("Error fetching art data:",o),A("REALITY_FETCH_ERROR: Unable to retrieve dadacat visions"),T(!1)}},v=o=>{const s=o.target.value;if(s&&_[s]){const c=_[s],r=Math.floor(Math.random()*c.length),p=c[r];console.log(`Selected prompt: "${s}" has ${c.length} items, chose index ${r}`),p&&a(p)}};return f?e.jsx("div",{className:"art-selector-section",children:e.jsxs("div",{className:"terminal-window",children:[e.jsxs("div",{className:"terminal-header",children:["> LOADING DADACAT_DATABASE...",e.jsx("br",{}),"> ESTABLISHING BACKBLAZE_CONNECTION..."]}),e.jsx("div",{className:"terminal-body",children:e.jsx("div",{className:"loading",children:"SCANNING DADACAT_FRAGMENTS"})})]})}):g?e.jsx("div",{className:"art-selector-section",children:e.jsx("div",{className:"terminal-window",children:e.jsx("div",{className:"terminal-header error-message",children:g})})}):e.jsx("div",{className:"art-selector-section",children:e.jsx("div",{className:"dropdown-container",children:e.jsxs("select",{className:"art-dropdown",onChange:v,defaultValue:"",children:[e.jsxs("option",{value:"",children:["> SELECT DADACAT VISION [",N.length," UNIQUE PROMPTS]"]}),N.map((o,s)=>e.jsx("option",{value:o,children:o},s))]})})})}function U({onGenerate:a,config:t}){var v,o;const[n,E]=l.useState(""),[d,N]=l.useState(!1),[I,_]=l.useState(null),[h,f]=l.useState([]),[T,g]=l.useState(((v=t==null?void 0:t.features)==null?void 0:v.useDirectPipeline)||!1),A=l.useMemo(()=>P((t==null?void 0:t.pipeline)||{}),[t]),x=async s=>{var c;if(s.preventDefault(),!!n.trim()){N(!0),_(null);try{let r;if(T){console.log("Using direct pipeline with configuration...");const p=t.buildPipelineInput(n.trim());f([{step:"Starting pipeline...",status:"running"}]);const u=await A.runConfigurablePipeline(p);if(u.steps&&((c=t==null?void 0:t.features)!=null&&c.showPipelineSteps)&&f(u.steps.map(m=>({step:`${m.lambda}`,status:m.success?"success":"failed",duration:m.duration?`${m.duration.toFixed(2)}s`:""}))),u.success&&u.finalResult){const m=u.finalResult;r={success:!0,human_prompt:n,dadacat_response:m.agentResponse,image_url:m.imageUrl,backblaze_path:m.b2Url,timestamp:new Date().toISOString(),job_id:m.jobId,run_id:m.runId}}else throw new Error(u.error||"Pipeline failed")}else{console.log("Using Express API proxy..."),console.log("Prompt value before sending:",JSON.stringify(n.trim()));const p={prompt:n.trim()};console.log("Request body:",JSON.stringify(p));const u=await fetch("/api/dadacat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!u.ok)throw new Error(`Server error: ${u.status}`);r=await u.json()}a({human_prompt:n,cleaned_prompt:r.dadacat_response,image_url:r.image_url,backblaze_path:r.backblaze_path,run_id:`interactive-${Date.now()}`}),E("")}catch(r){console.error("Error generating response:",r),_("REALITY_GENERATION_ERROR: Unable to manifest vision")}finally{N(!1)}}};return e.jsxs("div",{className:"interactive-dadacat-section",children:[e.jsxs("form",{onSubmit:x,className:"prompt-form",children:[e.jsxs("div",{className:"prompt-input-container",children:[e.jsx("input",{type:"text",value:n,onChange:s=>E(s.target.value),placeholder:"> ENTER YOUR VISION FOR DADACAT...",className:"prompt-input",disabled:d,maxLength:200}),e.jsx("button",{type:"submit",className:"generate-button",disabled:!n.trim()||d,children:d?"MANIFESTING...":"MANIFEST"})]}),I&&e.jsx("div",{className:"error-message",style:{marginTop:"10px"},children:I}),!1]}),d&&e.jsx("div",{className:"generating-status",children:e.jsxs("div",{className:"terminal-window",style:{marginTop:"20px"},children:[e.jsxs("div",{className:"terminal-header",children:["> CONSULTING DADACAT...",e.jsx("br",{}),"> TRANSLATING VISION TO REALITY...",e.jsx("br",{}),"> GENERATING MANIFESTATION..."]}),e.jsxs("div",{className:"terminal-body",children:[e.jsx("div",{className:"loading",children:"PROCESSING GNOSIS"}),h.length>0&&((o=t==null?void 0:t.features)==null?void 0:o.showPipelineSteps)&&e.jsx("div",{style:{marginTop:"10px",fontSize:"0.9em"},children:h.map((s,c)=>e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx("span",{style:{color:s.status==="success"?"#00ff00":s.status==="failed"?"#ff0040":"#999"},children:s.status==="success"?"✓":s.status==="failed"?"✗":"⟳"})," ",s.step,s.duration&&` (${s.duration})`]},c))})]})]})})]})}const M={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_ALLOW_RUNTIME_CONFIG:"false",VITE_API_ENDPOINT:"http://localhost:8080/api/dadacat",VITE_ARTPROJECT:"technodada",VITE_DEBUG_MODE:"false",VITE_DEFAULT_IMAGE_COUNT:"1",VITE_DEFAULT_MODEL:"dall-e-3",VITE_DEFAULT_QUALITY:"standard",VITE_DEFAULT_RESPONSE_FORMAT:"b64_json",VITE_DEFAULT_SIZE:"1024x1024",VITE_DEFAULT_STYLE:"vivid",VITE_ENVIRONMENT:"production",VITE_ON_WEBSITE:"yes",VITE_PIPELINE_MAX_RETRIES:"3",VITE_PIPELINE_POLLING_INTERVAL:"5",VITE_PIPELINE_RETRY_DELAY:"5",VITE_PIPELINE_TIMEOUT:"300",VITE_SHOW_PIPELINE_STEPS:"true",VITE_SOURCE:"tsdadacat",VITE_USE_DIRECT_PIPELINE:"false"},i=(a,t)=>M[a]||t,F={maxRetries:parseInt(i("VITE_PIPELINE_MAX_RETRIES","3")),retryDelay:parseInt(i("VITE_PIPELINE_RETRY_DELAY","5")),timeout:parseInt(i("VITE_PIPELINE_TIMEOUT","300")),pollingInterval:parseInt(i("VITE_PIPELINE_POLLING_INTERVAL","5"))},S={model:i("VITE_DEFAULT_MODEL","dall-e-3"),size:i("VITE_DEFAULT_SIZE","1024x1024"),quality:i("VITE_DEFAULT_QUALITY","standard"),style:i("VITE_DEFAULT_STYLE","vivid"),n:parseInt(i("VITE_DEFAULT_IMAGE_COUNT","1")),response_format:i("VITE_DEFAULT_RESPONSE_FORMAT","b64_json")},y={artproject:i("VITE_ARTPROJECT","technodada"),on_website:i("VITE_ON_WEBSITE","yes"),source:i("VITE_SOURCE","tsdadacat"),environment:i("VITE_ENVIRONMENT","production")},O={"dall-e-2":[{value:"256x256",display:"Small (256x256)"},{value:"512x512",display:"Medium (512x512)"},{value:"1024x1024",display:"Large (1024x1024)"}],"dall-e-3":[{value:"1024x1024",display:"Square (1024x1024)"},{value:"1792x1024",display:"Landscape (1792x1024)"},{value:"1024x1792",display:"Portrait (1024x1792)"}],"gpt-image-1":[{value:"1024x1024",display:"Square (1024x1024)"},{value:"1536x1024",display:"Landscape (1536x1024)"},{value:"1024x1536",display:"Portrait (1024x1536)"}]},R={"dall-e-2":["standard"],"dall-e-3":["standard","hd"],"gpt-image-1":["auto","high","medium","low"]},D={"dall-e-2":null,"dall-e-3":["vivid","natural"],"gpt-image-1":null},G={useDirect:i("VITE_USE_DIRECT_PIPELINE","false")==="true",showPipelineSteps:i("VITE_SHOW_PIPELINE_STEPS","true")==="true",allowRuntimeConfig:i("VITE_ALLOW_RUNTIME_CONFIG","false")==="true",debugMode:i("VITE_DEBUG_MODE","false")==="true"},z=(a,t={})=>{const n=new Date().toISOString(),E=t.batch_id||`tsdadacat_${Date.now()}`;return{human_prompt:a,batch_id:E,additional_prompt:t.additional_prompt||"manifested through technodada reality engine",options:{model:t.model||S.model,size:t.size||S.size,quality:t.quality||S.quality,style:t.style||S.style,n:t.n||S.n,response_format:t.response_format||S.response_format},artproject:t.artproject||y.artproject,on_website:t.on_website||y.on_website,custom_metadata:{source:y.source,environment:y.environment,timestamp:n,user_agent:navigator.userAgent,...t.custom_metadata}}},$=(a,t)=>{const n=[];return a.size&&O[t]&&(O[t].map(d=>d.value).includes(a.size)||n.push(`Invalid size for ${t}: ${a.size}`)),a.quality&&R[t]&&(R[t].includes(a.quality)||n.push(`Invalid quality for ${t}: ${a.quality}`)),a.style&&t==="dall-e-3"?D["dall-e-3"].includes(a.style)||n.push(`Invalid style for ${t}: ${a.style}`):a.style&&t!=="dall-e-3"&&n.push("Style option is only supported for dall-e-3"),{valid:n.length===0,errors:n}},q={pipeline:F,imageGeneration:S,metadata:y,modelOptions:{sizes:O,qualities:R,styles:D},features:G,buildPipelineInput:z,validateModelOptions:$};function B(){const[a,t]=l.useState(null),[n,E]=l.useState(!1),[d,N]=l.useState(null),[I,_]=l.useState("browse"),h=T=>{t(T),E(!1);const g=T.cleaned_prompt.length,A=Math.max(8e3,Math.min(12e3,g*40));N(A);const x=document.getElementById("gnosisLevel");x&&(x.textContent="0%")},f=()=>{E(!0)};return e.jsxs("div",{className:"art-viewer-container",children:[e.jsxs("header",{className:"art-viewer-header",children:[e.jsx("h1",{className:"glitch",children:"DADACAT_VIEWER"}),e.jsx("p",{className:"error-message",children:"WARNING: DadaCat visions only"})]}),e.jsxs("div",{className:"mode-selector",children:[e.jsx("button",{className:`mode-button ${I==="browse"?"active":""}`,onClick:()=>_("browse"),children:"BROWSE VISIONS"}),e.jsx("button",{className:`mode-button ${I==="interactive"?"active":""}`,onClick:()=>_("interactive"),children:"MANIFEST VISION"})]}),I==="browse"?e.jsx(C,{onArtSelect:h}):e.jsx(U,{onGenerate:h,config:q}),e.jsxs("div",{className:"content-display",children:[e.jsx(b,{prompt:(a==null?void 0:a.cleaned_prompt)||null,syncDuration:d,onTypingComplete:f}),e.jsx(V,{imageUrl:a?a.image_url||`https://f005.backblazeb2.com/file/td-website/${a.backblaze_path}`:null,startReveal:a!==null,syncDuration:d})]}),e.jsxs("nav",{className:"error-nav",style:{textAlign:"center",marginTop:"40px"},children:[e.jsx("a",{href:"/",className:"error-link",children:"[RETURN_TO_404]"}),e.jsx("a",{href:"/pages/gallery.html",className:"error-link",children:"[BROWSE_GALLERY]"}),e.jsx("a",{href:"/pages/poems.html",className:"error-link",children:"[ALL_VISIONS]"})]})]})}L.createRoot(document.getElementById("react-root")).render(e.jsx(j.StrictMode,{children:e.jsx(B,{})}));
