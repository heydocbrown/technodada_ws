import{r as s,j as e,c as P}from"./App-BiV6oCY1.js";import{T as B}from"./ThumbnailSelector-D2cdcWOr.js";function w({prompt:n,imageUrl:o,startOverlay:v,revealMode:d="topToBottom"}){const[i,g]=s.useState(!1),[y,I]=s.useState(0),[h,R]=s.useState(1),[A,j]=s.useState(100),[H,O]=s.useState(0),[S,N]=s.useState(!1),[E,T]=s.useState(""),L=s.useRef(null);s.useRef(null);const c=s.useRef(null);s.useEffect(()=>{n&&o&&(g(!1),I(0),j(100),N(!1),c.current&&clearInterval(c.current))},[n,o]),s.useEffect(()=>{if(v&&i&&y>0&&!S){N(!0);const a=document.getElementById("gnosisLevel");return a&&(a.textContent="0%"),setTimeout(()=>{if(d==="topToBottom"){let t=100;c.current=setInterval(()=>{if(t-=1,t<=0){t=0,clearInterval(c.current);const r=document.getElementById("gnosisLevel");r&&(r.textContent="100%")}j(t);const m=document.getElementById("gnosisLevel");if(m){const r=Math.round(100-t);m.textContent=r+"%"}},70)}else if(d==="randomPixels"){let t=0;c.current=setInterval(()=>{if(t+=1,t>=100){t=100,clearInterval(c.current);const r=document.getElementById("gnosisLevel");r&&(r.textContent="100%")}if(O(t),L.current){const r=k(200,Math.floor(200/h),t);T(r)}const m=document.getElementById("gnosisLevel");m&&(m.textContent=t+"%")},70)}},3e3),()=>{c.current&&clearInterval(c.current)}}},[v,i,y,S]);const k=(a,x,b)=>{const f=document.createElement("canvas");f.width=a,f.height=x;const t=f.getContext("2d");t.fillStyle="black",t.fillRect(0,0,a,x);const m=a*x,r=Math.floor(m*(b/100)),u=[];for(let l=0;l<m;l++)u.push(l);for(let l=u.length-1;l>0;l--){const p=Math.floor(Math.random()*(l+1));[u[l],u[p]]=[u[p],u[l]]}t.fillStyle="white";for(let l=0;l<r;l++){const p=u[l],C=p%a,M=Math.floor(p/a);t.fillRect(C,M,1,1)}return f.toDataURL()},_=a=>{if(g(!0),I(a.target.naturalHeight),R(a.target.naturalWidth/a.target.naturalHeight),d==="randomPixels"){const x=k(200,Math.floor(200/(a.target.naturalWidth/a.target.naturalHeight)),0);T(x)}};return!n&&!o?null:e.jsx("div",{className:"overlay-section",children:e.jsxs("div",{className:"terminal-window",children:[e.jsx("div",{className:"terminal-header",children:"> INITIATING REALITY_FUSION..."}),e.jsx("div",{className:"overlay-viewer",children:e.jsxs("div",{className:"overlay-container",style:{minHeight:i?`${600/h}px`:"500px",maxHeight:"700px"},children:[e.jsxs("div",{className:"overlay-text",children:["> ",e.jsx("span",{dangerouslySetInnerHTML:{__html:(n==null?void 0:n.replace(/\n/g,"<br/>"))||""}})]}),o&&i&&e.jsx("img",{ref:L,src:o,alt:"REALITY_OVERLAY",className:"overlay-image",style:d==="topToBottom"?{display:"block",clipPath:`inset(0 0 ${A}% 0)`}:{display:"block",maskImage:E?`url(${E})`:"none",maskSize:"100% 100%",maskRepeat:"no-repeat",WebkitMaskImage:E?`url(${E})`:"none",WebkitMaskSize:"100% 100%",WebkitMaskRepeat:"no-repeat"}}),o&&!i&&e.jsx("img",{src:o,alt:"PRELOAD",onLoad:_,style:{display:"none"}}),o&&!i&&e.jsxs("div",{className:"overlay-text",style:{display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",backgroundColor:"var(--gray-1)",zIndex:10},children:["> LOADING VISUAL_OVERLAY",e.jsx("br",{}),"> PREPARING FUSION_SEQUENCE"]})]})})]})})}function D(){const[n,o]=s.useState(null),[v,d]=s.useState(!0),[i,g]=s.useState("topToBottom"),y=I=>{o(I),d(!1);const h=document.getElementById("gnosisLevel");h&&(h.textContent="0%"),setTimeout(()=>{const R=window.pageYOffset||document.documentElement.scrollTop;d(!0),setTimeout(()=>{window.scrollTo({top:R,behavior:"instant"})},0)},11e3)};return e.jsxs("div",{className:"art-viewer-container",children:[e.jsxs("header",{className:"art-viewer-header",children:[e.jsx("h1",{className:"glitch",children:"TECHNODADA_FUSION"}),e.jsx("p",{className:"error-message",children:"WARNING: Reality layers may merge unexpectedly"}),e.jsxs("div",{className:"reveal-settings",style:{display:"flex",justifyContent:"center",gap:"15px",marginTop:"20px",fontFamily:"'VT323', monospace"},children:[e.jsx("span",{style:{color:"var(--terminal-green)",fontSize:"1.2rem"},children:"REVEAL_MODE:"}),e.jsx("button",{className:`project-button ${i==="topToBottom"?"active":""}`,onClick:()=>g("topToBottom"),style:{minWidth:"150px",padding:"8px 15px",fontSize:"0.9rem"},children:"TOPâ†’BOTTOM"}),e.jsx("button",{className:`project-button ${i==="randomPixels"?"active":""}`,onClick:()=>g("randomPixels"),style:{minWidth:"150px",padding:"8px 15px",fontSize:"0.9rem"},children:"RANDOM_PIXELS"})]})]}),n&&e.jsx("div",{className:"content-display",children:e.jsx(w,{prompt:(n==null?void 0:n.cleaned_prompt)||null,imageUrl:n?`https://f005.backblazeb2.com/file/td-website/${n.backblaze_path}`:null,startOverlay:n!==null,revealMode:i})}),e.jsx(B,{onArtSelect:y,isVisible:v}),e.jsxs("nav",{className:"error-nav",style:{textAlign:"center",marginTop:"40px"},children:[e.jsx("a",{href:"/",className:"error-link",children:"[RETURN_TO_404]"}),e.jsx("a",{href:"/pages/poems.html",className:"error-link",children:"[TEXT_VIEWER]"}),e.jsx("a",{href:"/pages/poem2.html",className:"error-link",children:"[GALLERY_VIEWER]"}),e.jsx("a",{href:"/pages/gallery.html",className:"error-link",children:"[BROWSE_GALLERY]"}),e.jsx("a",{href:"/pages/tools.html",className:"error-link",children:"[ACCESS_TOOLS]"})]})]})}P.createRoot(document.getElementById("root")).render(e.jsx(s.StrictMode,{children:e.jsx(D,{})}));
